<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuy·ªÉn h∆∞·ªõng...</title>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function isZaloWebView() {
            const ua = navigator.userAgent || navigator.vendor;
            return ua.includes("Zalo") || ua.includes("zalo");
        }

        function ensureSchema(url) {
            if (!url) return null;
            if (!url.startsWith("http://") && !url.startsWith("https://") && !url.startsWith("app://")) {
                return "https://" + url;
            }
            return url;
        }

        function showLink(url) {
            const linkElement = document.getElementById("manual-link");
            linkElement.href = url;
            linkElement.style.display = "block";
        }

        function openApp() {
            let targetLink = ensureSchema(getQueryParam("target"));
            let fallbackLink = ensureSchema(getQueryParam("fallback")) || "https://prestigeautomobile.vn";

            if (!targetLink) {
                console.error("‚ùå Missing target link");
                showLink(fallbackLink);
                return;
            }

            if (isZaloWebView()) {
                console.log("üîµ ƒêang ch·∫°y trong Zalo WebView, th·ª≠ m·ªü Safari...");

                // M·ªü Universal Link trong tab m·ªõi (ch·ªâ ho·∫°t ƒë·ªông tr√™n iOS Safari)
                let newTab = window.open(targetLink, "_blank");

                // N·∫øu tr√¨nh duy·ªát ch·∫∑n, hi·ªÉn th·ªã link ƒë·ªÉ ng∆∞·ªùi d√πng click
                if (!newTab || newTab.closed || typeof newTab.closed === "undefined") {
                    setTimeout(() => {
                        showLink(targetLink);
                    }, 2000);
                }
            } else {
                console.log("üü¢ Kh√¥ng ph·∫£i Zalo WebView, m·ªü tr·ª±c ti·∫øp");
                
                setTimeout(() => {
                    window.open(targetLink, "_blank");
                }, 100);
            }
        }
    </script>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            margin-top: 50px;
        }

        h2 {
            font-size: 24px;
            color: #333;
            animation: waveText 1.5s infinite ease-in-out;
        }

        @keyframes waveText {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        a {
            display: none;
            font-size: 18px;
            color: #007bff;
            text-decoration: underline;
            margin-top: 20px;
        }
    </style>
</head>
<body onload="openApp()">
    <h2>ƒêang m·ªü ·ª©ng d·ª•ng...</h2>
    <a id="manual-link" href="#" target="_blank">Nh·∫•n v√†o ƒë√¢y n·∫øu kh√¥ng t·ª± ƒë·ªông m·ªü</a>
</body>
</html>
